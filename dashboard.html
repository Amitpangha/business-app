<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BusinessOS Dashboard - Manage Your Business</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .sidebar-header h3 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .sidebar-header h3 i {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .nav-link {
            padding: 15px 20px;
            color: #555;
            font-weight: 500;
            border-left: 4px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .nav-link i {
            width: 24px;
            margin-right: 10px;
            font-size: 18px;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s;
        }
        
        /* Top Bar */
        .top-bar {
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Stats Cards */
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            transition: all 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 20px;
        }
        
        .icon-sales { background: linear-gradient(135deg, #4cc9f0, #4361ee); }
        .icon-customers { background: linear-gradient(135deg, #f72585, #3a0ca3); }
        .icon-pending { background: linear-gradient(135deg, #f8961e, #f72585); }
        .icon-inventory { background: linear-gradient(135deg, #4cc9f0, #3a0ca3); }
        
        .stats-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        /* Section Cards */
        .section-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section-header h4 {
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .section-header h4 i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        /* Tables */
        .table-custom {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .table-custom thead {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .table-custom th {
            border: none;
            padding: 15px;
            font-weight: 600;
        }
        
        .table-custom td {
            padding: 15px;
            vertical-align: middle;
            border-color: #f0f0f0;
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-sm {
            padding: 6px 15px;
            font-size: 14px;
        }
        
        .btn-outline-primary {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-outline-primary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Form Controls */
        .form-control, .form-select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
        }
        
        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                left: calc(-1 * var(--sidebar-width));
            }
            
            .sidebar.show {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .stats-card {
                margin-bottom: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .section-card {
                padding: 20px;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
        }
        
        /* Animation for notifications */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-store"></i> BusinessOS</h3>
        </div>
        
        <div class="sidebar-content">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('billing')">
                        <i class="fas fa-file-invoice-dollar"></i> Billing
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('inventory')">
                        <i class="fas fa-boxes"></i> Inventory
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('customers')">
                        <i class="fas fa-users"></i> Customers
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </li>
            </ul>
            
            <div class="px-3 mt-4">
                <div class="card bg-light border-0">
                    <div class="card-body p-3">
                        <h6 class="mb-2">Quick Stats</h6>
                        <small class="text-muted d-block mb-1">Today's Sales: <strong id="sidebarSales">₹0</strong></small>
                        <small class="text-muted d-block mb-1">Total Bills: <strong id="sidebarBills">0</strong></small>
                        <small class="text-muted d-block">Active Customers: <strong id="sidebarCustomers">0</strong></small>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 px-3">
                <button class="btn btn-outline-primary w-100" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <h4 class="mb-0" id="welcomeMessage">Welcome to Dashboard</h4>
                <small class="text-muted" id="currentDate"></small>
            </div>
            
            <div class="user-info">
                <div class="text-end">
                    <div id="userName">Shop Owner</div>
                    <small class="text-muted" id="userEmail">user@example.com</small>
                </div>
                <div class="user-avatar" id="userAvatar">S</div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboardSection">
            <!-- Stats Cards -->
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon icon-sales">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <h6 class="text-muted">Today's Sales</h6>
                        <div class="stats-value" id="todaySalesAmount">₹0</div>
                        <small class="text-success"><i class="fas fa-arrow-up"></i> 0% from yesterday</small>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon icon-customers">
                            <i class="fas fa-users"></i>
                        </div>
                        <h6 class="text-muted">Total Customers</h6>
                        <div class="stats-value" id="totalCustomersCount">0</div>
                        <small class="text-success"><i class="fas fa-user-plus"></i> 0 this month</small>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon icon-pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h6 class="text-muted">Pending Payments</h6>
                        <div class="stats-value" id="pendingPaymentsAmount">₹0</div>
                        <small class="text-danger"><i class="fas fa-exclamation-circle"></i> 0 overdue</small>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card">
                        <div class="stats-icon icon-inventory">
                            <i class="fas fa-box"></i>
                        </div>
                        <h6 class="text-muted">Low Stock Items</h6>
                        <div class="stats-value" id="lowStockItemsCount">0</div>
                        <small class="text-warning"><i class="fas fa-exclamation-triangle"></i> Needs attention</small>
                    </div>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="section-card">
                        <div class="section-header">
                            <h4><i class="fas fa-chart-line"></i> Sales Overview</h4>
                            <select class="form-select form-select-sm w-auto" id="chartPeriod" onchange="updateChart()">
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                            </select>
                        </div>
                        <canvas id="salesChart" height="250"></canvas>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="section-card">
                        <div class="section-header">
                            <h4><i class="fas fa-chart-pie"></i> Top Products</h4>
                        </div>
                        <canvas id="productsChart" height="250"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="section-card">
                        <div class="section-header">
                            <h4><i class="fas fa-history"></i> Recent Bills</h4>
                            <a href="#" class="btn btn-sm btn-outline-primary" onclick="showSection('billing')">View All</a>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-custom">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentBillsTable">
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">No bills yet</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="section-card">
                        <div class="section-header">
                            <h4><i class="fas fa-bell"></i> Notifications</h4>
                            <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">Mark All Read</button>
                        </div>
                        <div id="notificationsList">
                            <div class="alert alert-light border fade-in">
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-info-circle text-primary"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <small>Welcome to BusinessOS! Start by creating your first bill.</small>
                                        <div class="text-muted" style="font-size: 12px;">Just now</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Billing Section -->
        <div id="billingSection" style="display: none;">
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-file-invoice-dollar"></i> Create New Bill</h4>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="printLastBill()">
                            <i class="fas fa-print"></i> Print Last
                        </button>
                        <button class="btn btn-primary" onclick="saveBill()">
                            <i class="fas fa-save"></i> Save Bill
                        </button>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Customer Details -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Customer Details</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Customer Name *</label>
                                        <input type="text" class="form-control" id="customerName" placeholder="Enter customer name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="customerPhone" placeholder="Enter phone number">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Address</label>
                                    <textarea class="form-control" id="customerAddress" rows="2" placeholder="Enter address"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Items Table -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="card-title mb-0">Items</h5>
                                    <button class="btn btn-sm btn-primary" onclick="addItemRow()">
                                        <i class="fas fa-plus"></i> Add Item
                                    </button>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="itemsTable">
                                        <thead>
                                            <tr>
                                                <th width="40%">Item Name</th>
                                                <th width="15%">Quantity</th>
                                                <th width="15%">Rate (₹)</th>
                                                <th width="15%">Amount (₹)</th>
                                                <th width="15%">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="billItems">
                                            <!-- Items will be added here -->
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                                                <td><strong id="subtotalAmount">₹0.00</strong></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td colspan="3" class="text-end">
                                                    <label class="form-label me-2">GST %:</label>
                                                    <select class="form-select form-select-sm d-inline w-auto" id="gstPercentage">
                                                        <option value="0">0%</option>
                                                        <option value="5">5%</option>
                                                        <option value="12">12%</option>
                                                        <option value="18" selected>18%</option>
                                                        <option value="28">28%</option>
                                                    </select>
                                                </td>
                                                <td><strong id="gstAmount">₹0.00</strong></td>
                                                <td></td>
                                            </tr>
                                            <tr class="table-active">
                                                <td colspan="3" class="text-end"><h5 class="mb-0">Total:</h5></td>
                                                <td><h4 class="mb-0 text-primary" id="totalBillAmount">₹0.00</h4></td>
                                                <td></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Bill Summary -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Bill Summary</h5>
                                <div class="mb-3">
                                    <label class="form-label">Bill Number</label>
                                    <input type="text" class="form-control" id="billNumber" value="BILL-001" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="billDate" value="">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Payment Mode</label>
                                    <select class="form-select" id="paymentMode">
                                        <option value="cash">Cash</option>
                                        <option value="upi">UPI</option>
                                        <option value="card">Card</option>
                                        <option value="credit">Credit</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="billNotes" rows="3" placeholder="Additional notes..."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Quick Actions</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" onclick="clearBillForm()">
                                        <i class="fas fa-redo"></i> Clear Form
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="loadPreviousBill()">
                                        <i class="fas fa-history"></i> Load Previous
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="saveAsDraft()">
                                        <i class="fas fa-save"></i> Save as Draft
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- All Bills Table -->
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-list"></i> All Bills</h4>
                    <button class="btn btn-sm btn-outline-primary" onclick="exportBills()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-custom">
                        <thead>
                            <tr>
                                <th>Bill No.</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allBillsTable">
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">No bills found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Inventory Section -->
        <div id="inventorySection" style="display: none;">
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-boxes"></i> Inventory Management</h4>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="exportInventory()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-primary" onclick="showAddItemModal()">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="filterCategory" onchange="filterInventory()">
                            <option value="">All Categories</option>
                            <option value="grocery">Grocery</option>
                            <option value="stationery">Stationery</option>
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Stock Status</label>
                        <select class="form-select" id="filterStock" onchange="filterInventory()">
                            <option value="">All Items</option>
                            <option value="low">Low Stock</option>
                            <option value="out">Out of Stock</option>
                            <option value="sufficient">Sufficient Stock</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Sort By</label>
                        <select class="form-select" id="sortInventory" onchange="filterInventory()">
                            <option value="name">Name (A-Z)</option>
                            <option value="name_desc">Name (Z-A)</option>
                            <option value="stock_asc">Stock (Low to High)</option>
                            <option value="stock_desc">Stock (High to Low)</option>
                            <option value="price_asc">Price (Low to High)</option>
                            <option value="price_desc">Price (High to Low)</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInventory" placeholder="Search items..." onkeyup="filterInventory()">
                            <button class="btn btn-outline-secondary" onclick="filterInventory()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Inventory Table -->
                <div class="table-responsive">
                    <table class="table table-custom">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Min Qty</th>
                                <th>Price (₹)</th>
                                <th>Value (₹)</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <tr>
                                <td colspan="8" class="text-center text-muted py-4">No inventory items. Add your first item!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Customers Section -->
        <div id="customersSection" style="display: none;">
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-users"></i> Customer Management</h4>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="exportCustomers()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-primary" onclick="showAddCustomerModal()">
                            <i class="fas fa-user-plus"></i> Add Customer
                        </button>
                    </div>
                </div>
                
                <!-- Customer Grid -->
                <div class="row" id="customersGrid">
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No customers yet. Add your first customer!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div id="reportsSection" style="display: none;">
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-chart-bar"></i> Business Reports</h4>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-chart-line"></i> Generate Report
                    </button>
                </div>
                
                <!-- Report Filters -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Report Type</label>
                        <select class="form-select" id="reportType">
                            <option value="daily">Daily Sales Report</option>
                            <option value="weekly">Weekly Summary</option>
                            <option value="monthly">Monthly Report</option>
                            <option value="yearly">Yearly Report</option>
                            <option value="customer">Customer-wise Report</option>
                            <option value="product">Product-wise Report</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="reportFromDate">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="reportToDate">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Format</label>
                        <select class="form-select" id="reportFormat">
                            <option value="html">Web View</option>
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                        </select>
                    </div>
                </div>
                
                <!-- Report Output -->
                <div id="reportOutput" class="border rounded p-4 bg-light">
                    <div class="text-center py-5">
                        <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Select filters and generate report</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Section -->
        <div id="settingsSection" style="display: none;">
            <div class="section-card">
                <div class="section-header">
                    <h4><i class="fas fa-cog"></i> Settings</h4>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
                
                <div class="row">
                    <!-- Business Settings -->
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Business Information</h5>
                                <div class="mb-3">
                                    <label class="form-label">Shop/Business Name</label>
                                    <input type="text" class="form-control" id="settingShopName">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">GST Number</label>
                                    <input type="text" class="form-control" id="settingGST">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Address</label>
                                    <textarea class="form-control" id="settingAddress" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="settingPhone">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="settingEmail">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Invoice Settings -->
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Invoice Settings</h5>
                                <div class="mb-3">
                                    <label class="form-label">Default GST %</label>
                                    <select class="form-select" id="settingDefaultGST">
                                        <option value="0">0%</option>
                                        <option value="5">5%</option>
                                        <option value="12">12%</option>
                                        <option value="18">18%</option>
                                        <option value="28">28%</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Invoice Prefix</label>
                                    <input type="text" class="form-control" id="settingInvoicePrefix" value="INV-">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Invoice Footer</label>
                                    <textarea class="form-control" id="settingInvoiceFooter" rows="3">Thank you for your business!</textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Terms & Conditions</label>
                                    <textarea class="form-control" id="settingTerms" rows="3">Goods once sold will not be taken back.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Data Management</h5>
                        <div class="alert alert-warning mb-4">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Be careful with these actions. Some actions cannot be undone.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-primary w-100" onclick="backupData()">
                                    <i class="fas fa-download"></i> Backup Data
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-primary w-100" onclick="importData()">
                                    <i class="fas fa-upload"></i> Import Data
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-warning w-100" onclick="clearDrafts()">
                                    <i class="fas fa-trash"></i> Clear Drafts
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-danger w-100" onclick="resetData()">
                                    <i class="fas fa-redo"></i> Reset All Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Inventory Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addItemForm">
                        <div class="mb-3">
                            <label class="form-label">Item Name *</label>
                            <input type="text" class="form-control" id="modalItemName" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="modalItemCategory">
                                    <option value="grocery">Grocery</option>
                                    <option value="stationery">Stationery</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="clothing">Clothing</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Unit</label>
                                <input type="text" class="form-control" id="modalItemUnit" value="Pcs">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Current Stock *</label>
                                <input type="number" class="form-control" id="modalItemStock" required min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Min Quantity (Alert)</label>
                                <input type="number" class="form-control" id="modalItemMinQty" value="10" min="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Purchase Price (₹)</label>
                                <input type="number" class="form-control" id="modalItemCost" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Selling Price (₹) *</label>
                                <input type="number" class="form-control" id="modalItemPrice" required step="0.01">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="modalItemDesc" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Add Item</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCustomerForm">
                        <div class="mb-3">
                            <label class="form-label">Customer Name *</label>
                            <input type="text" class="form-control" id="modalCustomerName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" class="form-control" id="modalCustomerPhone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="modalCustomerEmail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="modalCustomerAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Credit Limit (₹)</label>
                                <input type="number" class="form-control" id="modalCustomerCredit" value="10000">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Opening Balance (₹)</label>
                                <input type="number" class="form-control" id="modalCustomerBalance" value="0">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Add Customer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- View Bill Modal -->
    <div class="modal fade" id="viewBillModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Invoice Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="billDetailsContent">
                    <!-- Bill details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="printCurrentBill()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-outline-primary" onclick="downloadBillPDF()">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Toast -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div class="toast" id="successToast" role="alert">
            <div class="toast-header bg-success text-white">
                <strong class="me-auto"><i class="fas fa-check-circle"></i> Success</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operation completed successfully!
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ====================
        // GLOBAL VARIABLES
        // ====================
        let currentItems = [];
        let allBills = [];
        let inventory = [];
        let customers = [];
        let settings = {};
        let currentBillId = null;
        let salesChart = null;
        let productsChart = null;
        
        // ====================
        // INITIALIZATION
        // ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            checkAuth();
            
            // Load all data
            loadAllData();
            
            // Initialize date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('billDate').value = today;
            
            // Load user info
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            document.getElementById('welcomeMessage').textContent = `Welcome, ${userData.shopName || 'Shop Owner'}!`;
            document.getElementById('userName').textContent = userData.shopName || 'Shop Owner';
            document.getElementById('userEmail').textContent = userData.email || 'user@example.com';
            document.getElementById('userAvatar').textContent = (userData.shopName || 'S').charAt(0).toUpperCase();
            
            // Initialize settings
            if (!settings.shopName && userData.shopName) {
                settings.shopName = userData.shopName;
                settings.email = userData.email;
                settings.phone = userData.phone;
            }
            
            // Initialize bill number
            updateBillNumber();
            
            // Add first item row
            addItemRow();
            
            // Show dashboard by default
            showSection('dashboard');
            
            // Setup auto-save
            setInterval(autoSaveData, 30000); // Auto-save every 30 seconds
            
            // Setup inactivity timer
            setupInactivityTimer();
            
            console.log('BusinessOS Dashboard initialized successfully!');
        });
        
        // ====================
        // AUTHENTICATION
        // ====================
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('userLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = 'index.html';
            }
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('userLoggedIn');
                window.location.href = 'index.html';
            }
        }
        
        // ====================
        // DATA MANAGEMENT
        // ====================
        function loadAllData() {
            try {
                allBills = JSON.parse(localStorage.getItem('businessBills') || '[]');
                inventory = JSON.parse(localStorage.getItem('inventory') || '[]');
                customers = JSON.parse(localStorage.getItem('customers') || '[]');
                settings = JSON.parse(localStorage.getItem('settings') || '{}');
                
                console.log(`Loaded: ${allBills.length} bills, ${inventory.length} inventory items, ${customers.length} customers`);
                
                // Update UI with loaded data
                updateDashboardStats();
                updateRecentBills();
                updateAllBillsTable();
                updateInventoryTable();
                updateCustomersGrid();
                updateSettingsForm();
                
                // Initialize charts
                setTimeout(initializeCharts, 500);
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading data', 'danger');
            }
        }
        
        function autoSaveData() {
            try {
                localStorage.setItem('businessBills', JSON.stringify(allBills));
                localStorage.setItem('inventory', JSON.stringify(inventory));
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('settings', JSON.stringify(settings));
                
                // Update last activity
                localStorage.setItem('lastActivity', Date.now());
                
                console.log('Data auto-saved');
            } catch (error) {
                console.error('Auto-save failed:', error);
            }
        }
        
        function backupData() {
            const data = {
                bills: allBills,
                inventory: inventory,
                customers: customers,
                settings: settings,
                backupDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `businessos-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Backup downloaded successfully!', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace all your current data. Continue?')) {
                            if (importedData.bills) allBills = importedData.bills;
                            if (importedData.inventory) inventory = importedData.inventory;
                            if (importedData.customers) customers = importedData.customers;
                            if (importedData.settings) settings = importedData.settings;
                            
                            autoSaveData();
                            loadAllData();
                            
                            showToast('Data imported successfully!', 'success');
                        }
                    } catch (error) {
                        showToast('Error importing file: Invalid format', 'danger');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function resetData() {
            if (confirm('WARNING: This will delete ALL your data and cannot be undone! Continue?')) {
                localStorage.clear();
                window.location.reload();
            }
        }
        
        // ====================
        // DASHBOARD FUNCTIONS
        // ====================
        function updateDashboardStats() {
            const today = new Date().toLocaleDateString();
            
            // Today's sales
            const todaySales = allBills
                .filter(bill => new Date(bill.date).toLocaleDateString() === today)
                .reduce((sum, bill) => sum + bill.total, 0);
            
            document.getElementById('todaySalesAmount').textContent = `₹${todaySales.toFixed(2)}`;
            document.getElementById('sidebarSales').textContent = `₹${todaySales.toFixed(2)}`;
            
            // Total customers
            const uniqueCustomers = [...new Set(allBills.map(bill => bill.customerName))];
            document.getElementById('totalCustomersCount').textContent = customers.length || uniqueCustomers.length;
            document.getElementById('sidebarCustomers').textContent = customers.length || uniqueCustomers.length;
            
            // Pending payments (simulated - 20% of total sales as credit)
            const pending = allBills.reduce((sum, bill) => sum + (bill.total * 0.2), 0);
            document.getElementById('pendingPaymentsAmount').textContent = `₹${pending.toFixed(2)}`;
            
            // Low stock items
            const lowStock = inventory.filter(item => item.stock <= item.minQty).length;
            document.getElementById('lowStockItemsCount').textContent = lowStock;
            
            // Total bills
            document.getElementById('sidebarBills').textContent = allBills.length;
            
            // Update notifications
            updateNotifications();
        }
        
        function updateNotifications() {
            const notifications = [];
            
            // Low stock notifications
            inventory.filter(item => item.stock <= item.minQty).forEach(item => {
                notifications.push({
                    type: 'warning',
                    message: `${item.name} is low on stock (${item.stock} left)`,
                    time: 'Today'
                });
            });
            
            // Recent bills notifications
            if (allBills.length > 0) {
                const recentBill = allBills[allBills.length - 1];
                notifications.push({
                    type: 'info',
                    message: `New bill created for ${recentBill.customerName} - ₹${recentBill.total.toFixed(2)}`,
                    time: 'Today'
                });
            }
            
            // Update notifications UI
            const container = document.getElementById('notificationsList');
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-light border">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-success"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <small>All caught up! No notifications.</small>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                let html = '';
                notifications.forEach(notif => {
                    html += `
                    <div class="alert alert-light border fade-in mb-2">
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-${notif.type === 'warning' ? 'exclamation-triangle text-warning' : 'info-circle text-primary'}"></i>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <small>${notif.message}</small>
                                <div class="text-muted" style="font-size: 12px;">${notif.time}</div>
                            </div>
                        </div>
                    </div>
                    `;
                });
                container.innerHTML = html;
            }
        }
        
        function markAllAsRead() {
            // In a real app, you would mark notifications as read in database
            showToast('All notifications marked as read', 'success');
        }
        
        // ====================
        // CHART FUNCTIONS
        // ====================
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Daily Sales (₹)',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Products Chart
            const productsCtx = document.getElementById('productsChart').getContext('2d');
            productsChart = new Chart(productsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Grocery', 'Stationery', 'Electronics', 'Other'],
                    datasets: [{
                        data: [40, 20, 25, 15],
                        backgroundColor: [
                            '#4361ee',
                            '#4cc9f0',
                            '#f72585',
                            '#f8961e'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '70%'
                }
            });
            
            // Update charts with real data
            updateChart();
        }
        
        function updateChart() {
            const days = parseInt(document.getElementById('chartPeriod').value);
            const labels = [];
            const data = [];
            
            // Generate last N days
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const label = date.toLocaleDateString('en-IN', { weekday: 'short' });
                labels.push(label);
                
                // Calculate sales for this day
                const daySales = allBills
                    .filter(bill => {
                        const billDate = new Date(bill.date);
                        return billDate.toDateString() === date.toDateString();
                    })
                    .reduce((sum, bill) => sum + bill.total, 0);
                
                data.push(daySales);
            }
            
            // Update sales chart
            if (salesChart) {
                salesChart.data.labels = labels;
                salesChart.data.datasets[0].data = data;
                salesChart.update();
            }
        }
        
        // ====================
        // BILLING FUNCTIONS
        // ====================
        function addItemRow() {
            const table = document.getElementById('billItems');
            const rowId = Date.now();
            const row = document.createElement('tr');
            row.id = `itemRow_${rowId}`;
            row.innerHTML = `
                <td>
                    <input type="text" class="form-control item-name" placeholder="Item name" onchange="updateItem(${rowId})">
                </td>
                <td>
                    <input type="number" class="form-control item-qty" value="1" min="1" onchange="updateItem(${rowId})">
                </td>
                <td>
                    <input type="number" class="form-control item-rate" value="0" step="0.01" min="0" onchange="updateItem(${rowId})">
                </td>
                <td>
                    <input type="text" class="form-control item-amount" value="0.00" readonly>
                </td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="removeItemRow(${rowId})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            table.appendChild(row);
            updateBillTotal();
        }
        
        function removeItemRow(rowId) {
            const row = document.getElementById(`itemRow_${rowId}`);
            if (row) {
                row.remove();
                updateBillTotal();
            }
        }
        
        function updateItem(rowId) {
            const row = document.getElementById(`itemRow_${rowId}`);
            if (!row) return;
            
            const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
            const rate = parseFloat(row.querySelector('.item-rate').value) || 0;
            const amount = qty * rate;
            
            row.querySelector('.item-amount').value = amount.toFixed(2);
            updateBillTotal();
        }
        
        function updateBillTotal() {
            let subtotal = 0;
            const rows = document.querySelectorAll('#billItems tr');
            
            rows.forEach(row => {
                const amount = parseFloat(row.querySelector('.item-amount').value) || 0;
                subtotal += amount;
            });
            
            const gstPercent = parseFloat(document.getElementById('gstPercentage').value) || 0;
            const gstAmount = subtotal * (gstPercent / 100);
            const total = subtotal + gstAmount;
            
            document.getElementById('subtotalAmount').textContent = `₹${subtotal.toFixed(2)}`;
            document.getElementById('gstAmount').textContent = `₹${gstAmount.toFixed(2)}`;
            document.getElementById('totalBillAmount').textContent = `₹${total.toFixed(2)}`;
        }
        
        function updateBillNumber() {
            const lastBillNumber = allBills.length > 0 ? 
                Math.max(...allBills.map(bill => parseInt(bill.billNumber?.replace(/\D/g, '') || 0))) : 0;
            const nextBillNumber = lastBillNumber + 1;
            document.getElementById('billNumber').value = `INV-${nextBillNumber.toString().padStart(3, '0')}`;
        }
        
        function saveBill() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const billNumber = document.getElementById('billNumber').value;
            const billDate = document.getElementById('billDate').value;
            const paymentMode = document.getElementById('paymentMode').value;
            const notes = document.getElementById('billNotes').value;
            
            // Validate customer name
            if (!customerName) {
                showToast('Please enter customer name', 'warning');
                document.getElementById('customerName').focus();
                return;
            }
            
            // Get items
            const items = [];
            let isValid = true;
            
            document.querySelectorAll('#billItems tr').forEach((row, index) => {
                const name = row.querySelector('.item-name').value.trim();
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const rate = parseFloat(row.querySelector('.item-rate').value) || 0;
                
                if (name && qty > 0 && rate > 0) {
                    items.push({
                        id: index + 1,
                        name: name,
                        quantity: qty,
                        rate: rate,
                        amount: qty * rate
                    });
                } else if (name || qty > 0 || rate > 0) {
                    isValid = false;
                }
            });
            
            if (!isValid) {
                showToast('Please fill all item details correctly', 'warning');
                return;
            }
            
            if (items.length === 0) {
                showToast('Please add at least one item', 'warning');
                return;
            }
            
            // Calculate totals
            const subtotal = items.reduce((sum, item) => sum + item.amount, 0);
            const gstPercent = parseFloat(document.getElementById('gstPercentage').value) || 0;
            const gstAmount = subtotal * (gstPercent / 100);
            const total = subtotal + gstAmount;
            
            // Create bill object
            const bill = {
                id: Date.now(),
                billNumber: billNumber,
                customerName: customerName,
                customerPhone: customerPhone,
                customerAddress: document.getElementById('customerAddress').value,
                date: billDate,
                items: items,
                subtotal: subtotal,
                gstPercent: gstPercent,
                gstAmount: gstAmount,
                total: total,
                paymentMode: paymentMode,
                notes: notes,
                status: 'paid',
                createdAt: new Date().toISOString()
            };
            
            // Add to bills array
            allBills.push(bill);
            
            // Update inventory (reduce stock)
            updateInventoryFromBill(items);
            
            // Save to localStorage
            autoSaveData();
            
            // Update UI
            updateDashboardStats();
            updateRecentBills();
            updateAllBillsTable();
            updateBillNumber();
            
            // Clear form
            clearBillForm();
            
            // Show success message
            showToast(`Bill saved successfully! Total: ₹${total.toFixed(2)}`, 'success');
            
            // Play success sound
            playSuccessSound();
        }
        
        function updateInventoryFromBill(items) {
            items.forEach(billItem => {
                // Find item in inventory
                const inventoryItem = inventory.find(item => 
                    item.name.toLowerCase() === billItem.name.toLowerCase());
                
                if (inventoryItem) {
                    // Reduce stock
                    inventoryItem.stock -= billItem.quantity;
                    if (inventoryItem.stock < 0) inventoryItem.stock = 0;
                }
            });
            
            // Update inventory table if visible
            if (document.getElementById('inventorySection').style.display !== 'none') {
                updateInventoryTable();
            }
        }
        
        function clearBillForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('billNotes').value = '';
            document.getElementById('billItems').innerHTML = '';
            addItemRow();
            updateBillTotal();
            updateBillNumber();
        }
        
        function saveAsDraft() {
            // Similar to saveBill but with draft status
            showToast('Bill saved as draft', 'info');
        }
        
        function loadPreviousBill() {
            if (allBills.length > 0) {
                const lastBill = allBills[allBills.length - 1];
                document.getElementById('customerName').value = lastBill.customerName;
                document.getElementById('customerPhone').value = lastBill.customerPhone || '';
                document.getElementById('customerAddress').value = lastBill.customerAddress || '';
                showToast('Previous bill loaded', 'info');
            } else {
                showToast('No previous bills found', 'warning');
            }
        }
        
        function updateRecentBills() {
            const table = document.getElementById('recentBillsTable');
            const recentBills = allBills.slice(-5).reverse();
            
            if (recentBills.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">No bills yet</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            recentBills.forEach(bill => {
                html += `
                <tr>
                    <td>${bill.customerName}</td>
                    <td>₹${bill.total.toFixed(2)}</td>
                    <td>${new Date(bill.date).toLocaleDateString('en-IN')}</td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }
        
        function updateAllBillsTable() {
            const table = document.getElementById('allBillsTable');
            
            if (allBills.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">No bills found</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            allBills.slice().reverse().forEach((bill, index) => {
                const statusClass = bill.status === 'paid' ? 'success' : 
                                  bill.status === 'pending' ? 'warning' : 'secondary';
                
                html += `
                <tr>
                    <td>${bill.billNumber}</td>
                    <td>${bill.customerName}</td>
                    <td>${new Date(bill.date).toLocaleDateString('en-IN')}</td>
                    <td>${bill.items.length}</td>
                    <td>₹${bill.total.toFixed(2)}</td>
                    <td><span class="badge bg-${statusClass}">${bill.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewBill(${bill.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning me-1" onclick="editBill(${bill.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteBill(${bill.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }
        
        function viewBill(billId) {
            const bill = allBills.find(b => b.id === billId);
            if (!bill) return;
            
            let itemsHtml = '';
            bill.items.forEach(item => {
                itemsHtml += `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>₹${item.rate.toFixed(2)}</td>
                    <td>₹${item.amount.toFixed(2)}</td>
                </tr>
                `;
            });
            
            const content = `
            <div class="invoice-preview">
                <div class="text-center mb-4">
                    <h4>${settings.shopName || 'BusinessOS'}</h4>
                    <p class="text-muted mb-0">${settings.address || ''}</p>
                    <p class="text-muted">${settings.phone || ''} | ${settings.email || ''}</p>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5>Bill To:</h5>
                        <p class="mb-1"><strong>${bill.customerName}</strong></p>
                        <p class="mb-1">${bill.customerPhone || ''}</p>
                        <p class="mb-0">${bill.customerAddress || ''}</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <h5>Invoice Details</h5>
                        <p class="mb-1"><strong>Invoice #:</strong> ${bill.billNumber}</p>
                        <p class="mb-1"><strong>Date:</strong> ${new Date(bill.date).toLocaleDateString('en-IN')}</p>
                        <p class="mb-0"><strong>Payment Mode:</strong> ${bill.paymentMode}</p>
                    </div>
                </div>
                
                <div class="table-responsive mb-4">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Rate</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                                <td><strong>₹${bill.subtotal.toFixed(2)}</strong></td>
                            </tr>
                            <tr>
                                <td colspan="3" class="text-end"><strong>GST (${bill.gstPercent}%):</strong></td>
                                <td><strong>₹${bill.gstAmount.toFixed(2)}</strong></td>
                            </tr>
                            <tr class="table-active">
                                <td colspan="3" class="text-end"><h5 class="mb-0">Total:</h5></td>
                                <td><h4 class="mb-0">₹${bill.total.toFixed(2)}</h4></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                ${bill.notes ? `<div class="alert alert-light"><strong>Notes:</strong> ${bill.notes}</div>` : ''}
                
                <div class="mt-4 pt-4 border-top text-center text-muted">
                    <p class="mb-0">${settings.invoiceFooter || 'Thank you for your business!'}</p>
                </div>
            </div>
            `;
            
            document.getElementById('billDetailsContent').innerHTML = content;
            const modal = new bootstrap.Modal(document.getElementById('viewBillModal'));
            modal.show();
        }
        
        function editBill(billId) {
            const bill = allBills.find(b => b.id === billId);
            if (!bill) return;
            
            // Populate form with bill data
            document.getElementById('customerName').value = bill.customerName;
            document.getElementById('customerPhone').value = bill.customerPhone || '';
            document.getElementById('customerAddress').value = bill.customerAddress || '';
            document.getElementById('billNumber').value = bill.billNumber;
            document.getElementById('billDate').value = bill.date;
            document.getElementById('paymentMode').value = bill.paymentMode;
            document.getElementById('billNotes').value = bill.notes || '';
            document.getElementById('gstPercentage').value = bill.gstPercent;
            
            // Clear existing items
            document.getElementById('billItems').innerHTML = '';
            
            // Add items
            bill.items.forEach((item, index) => {
                const rowId = Date.now() + index;
                const row = document.createElement('tr');
                row.id = `itemRow_${rowId}`;
                row.innerHTML = `
                    <td>
                        <input type="text" class="form-control item-name" value="${item.name}" onchange="updateItem(${rowId})">
                    </td>
                    <td>
                        <input type="number" class="form-control item-qty" value="${item.quantity}" min="1" onchange="updateItem(${rowId})">
                    </td>
                    <td>
                        <input type="number" class="form-control item-rate" value="${item.rate}" step="0.01" min="0" onchange="updateItem(${rowId})">
                    </td>
                    <td>
                        <input type="text" class="form-control item-amount" value="${item.amount.toFixed(2)}" readonly>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeItemRow(${rowId})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                document.getElementById('billItems').appendChild(row);
            });
            
            updateBillTotal();
            showSection('billing');
            showToast('Bill loaded for editing', 'info');
        }
        
        function deleteBill(billId) {
            if (confirm('Are you sure you want to delete this bill?')) {
                const index = allBills.findIndex(b => b.id === billId);
                if (index !== -1) {
                    allBills.splice(index, 1);
                    autoSaveData();
                    updateDashboardStats();
                    updateRecentBills();
                    updateAllBillsTable();
                    showToast('Bill deleted successfully', 'success');
                }
            }
        }
        
        function printLastBill() {
            if (allBills.length > 0) {
                viewBill(allBills[allBills.length - 1].id);
                setTimeout(() => {
                    window.print();
                }, 500);
            } else {
                showToast('No bills to print', 'warning');
            }
        }
        
        function printCurrentBill() {
            window.print();
        }
        
        function downloadBillPDF() {
            showToast('PDF download feature coming soon!', 'info');
        }
        
        function exportBills() {
            if (allBills.length === 0) {
                showToast('No bills to export', 'warning');
                return;
            }
            
            const csv = convertToCSV(allBills);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bills-export-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Bills exported successfully', 'success');
        }
        
        // ====================
        // INVENTORY FUNCTIONS
        // ====================
        function showAddItemModal() {
            const modal = new bootstrap.Modal(document.getElementById('addItemModal'));
            modal.show();
        }
        
        document.getElementById('addItemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const item = {
                id: Date.now(),
                name: document.getElementById('modalItemName').value.trim(),
                category: document.getElementById('modalItemCategory').value,
                unit: document.getElementById('modalItemUnit').value.trim() || 'Pcs',
                stock: parseInt(document.getElementById('modalItemStock').value) || 0,
                minQty: parseInt(document.getElementById('modalItemMinQty').value) || 10,
                cost: parseFloat(document.getElementById('modalItemCost').value) || 0,
                price: parseFloat(document.getElementById('modalItemPrice').value) || 0,
                description: document.getElementById('modalItemDesc').value.trim(),
                addedDate: new Date().toISOString()
            };
            
            if (!item.name) {
                showToast('Please enter item name', 'warning');
                return;
            }
            
            inventory.push(item);
            autoSaveData();
            updateInventoryTable();
            updateDashboardStats();
            
            // Close modal and reset form
            bootstrap.Modal.getInstance(document.getElementById('addItemModal')).hide();
            e.target.reset();
            
            showToast('Item added to inventory', 'success');
        });
        
        function updateInventoryTable() {
            const table = document.getElementById('inventoryTable');
            
            if (inventory.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">No inventory items. Add your first item!</td>
                    </tr>
                `;
                return;
            }
            
            // Filter and sort
            let filtered = [...inventory];
            const category = document.getElementById('filterCategory').value;
            const stockFilter = document.getElementById('filterStock').value;
            const search = document.getElementById('searchInventory').value.toLowerCase();
            const sortBy = document.getElementById('sortInventory').value;
            
            // Apply filters
            if (category) {
                filtered = filtered.filter(item => item.category === category);
            }
            
            if (stockFilter === 'low') {
                filtered = filtered.filter(item => item.stock <= item.minQty);
            } else if (stockFilter === 'out') {
                filtered = filtered.filter(item => item.stock === 0);
            } else if (stockFilter === 'sufficient') {
                filtered = filtered.filter(item => item.stock > item.minQty);
            }
            
            if (search) {
                filtered = filtered.filter(item => 
                    item.name.toLowerCase().includes(search) ||
                    item.description.toLowerCase().includes(search)
                );
            }
            
            // Apply sorting
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'name_desc': return b.name.localeCompare(a.name);
                    case 'stock_asc': return a.stock - b.stock;
                    case 'stock_desc': return b.stock - a.stock;
                    case 'price_asc': return a.price - b.price;
                    case 'price_desc': return b.price - a.price;
                    default: return a.name.localeCompare(b.name);
                }
            });
            
            // Generate table rows
            let html = '';
            filtered.forEach(item => {
                const isLowStock = item.stock <= item.minQty;
                const isOutOfStock = item.stock === 0;
                const statusClass = isOutOfStock ? 'danger' : isLowStock ? 'warning' : 'success';
                const statusText = isOutOfStock ? 'Out of Stock' : isLowStock ? 'Low Stock' : 'In Stock';
                const stockValue = item.stock * item.price;
                
                html += `
                <tr>
                    <td>
                        <strong>${item.name}</strong>
                        ${item.description ? `<br><small class="text-muted">${item.description}</small>` : ''}
                    </td>
                    <td><span class="badge bg-info">${item.category}</span></td>
                    <td>
                        ${item.stock} ${item.unit}
                        ${isLowStock ? '<i class="fas fa-exclamation-triangle text-warning ms-2"></i>' : ''}
                    </td>
                    <td>${item.minQty}</td>
                    <td>₹${item.price.toFixed(2)}</td>
                    <td>₹${stockValue.toFixed(2)}</td>
                    <td><span class="badge bg-${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editInventoryItem(${item.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteInventoryItem(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }
        
        function filterInventory() {
            updateInventoryTable();
        }
        
        function editInventoryItem(itemId) {
            const item = inventory.find(i => i.id === itemId);
            if (!item) return;
            
            // Populate modal with item data
            document.getElementById('modalItemName').value = item.name;
            document.getElementById('modalItemCategory').value = item.category;
            document.getElementById('modalItemUnit').value = item.unit;
            document.getElementById('modalItemStock').value = item.stock;
            document.getElementById('modalItemMinQty').value = item.minQty;
            document.getElementById('modalItemCost').value = item.cost;
            document.getElementById('modalItemPrice').value = item.price;
            document.getElementById('modalItemDesc').value = item.description;
            
            // Change modal title and submit button
            const modal = document.getElementById('addItemModal');
            modal.querySelector('.modal-title').textContent = 'Edit Inventory Item';
            modal.querySelector('button[type="submit"]').textContent = 'Update Item';
            
            // Remove existing event listener and add new one
            const form = document.getElementById('addItemForm');
            const newForm = form.cloneNode(true);
            form.parentNode.replaceChild(newForm, form);
            
            newForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Update item
                item.name = document.getElementById('modalItemName').value.trim();
                item.category = document.getElementById('modalItemCategory').value;
                item.unit = document.getElementById('modalItemUnit').value.trim() || 'Pcs';
                item.stock = parseInt(document.getElementById('modalItemStock').value) || 0;
                item.minQty = parseInt(document.getElementById('modalItemMinQty').value) || 10;
                item.cost = parseFloat(document.getElementById('modalItemCost').value) || 0;
                item.price = parseFloat(document.getElementById('modalItemPrice').value) || 0;
                item.description = document.getElementById('modalItemDesc').value.trim();
                
                autoSaveData();
                updateInventoryTable();
                updateDashboardStats();
                
                bootstrap.Modal.getInstance(document.getElementById('addItemModal')).hide();
                newForm.reset();
                
                // Reset modal for next use
                modal.querySelector('.modal-title').textContent = 'Add Inventory Item';
                modal.querySelector('button[type="submit"]').textContent = 'Add Item';
                
                showToast('Item updated successfully', 'success');
            });
            
            const modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        }
        
        function deleteInventoryItem(itemId) {
            if (confirm('Are you sure you want to delete this item?')) {
                const index = inventory.findIndex(i => i.id === itemId);
                if (index !== -1) {
                    inventory.splice(index, 1);
                    autoSaveData();
                    updateInventoryTable();
                    updateDashboardStats();
                    showToast('Item deleted successfully', 'success');
                }
            }
        }
        
        function exportInventory() {
            if (inventory.length === 0) {
                showToast('No inventory to export', 'warning');
                return;
            }
            
            const csv = convertToCSV(inventory);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory-export-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Inventory exported successfully', 'success');
        }
        
        // ====================
        // CUSTOMER FUNCTIONS
        // ====================
        function showAddCustomerModal() {
            const modal = new bootstrap.Modal(document.getElementById('addCustomerModal'));
            modal.show();
        }
        
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customer = {
                id: Date.now(),
                name: document.getElementById('modalCustomerName').value.trim(),
                phone: document.getElementById('modalCustomerPhone').value.trim(),
                email: document.getElementById('modalCustomerEmail').value.trim(),
                address: document.getElementById('modalCustomerAddress').value.trim(),
                creditLimit: parseFloat(document.getElementById('modalCustomerCredit').value) || 0,
                openingBalance: parseFloat(document.getElementById('modalCustomerBalance').value) || 0,
                currentBalance: 0,
                totalPurchases: 0,
                lastPurchase: null,
                createdAt: new Date().toISOString()
            };
            
            if (!customer.name || !customer.phone) {
                showToast('Please enter customer name and phone number', 'warning');
                return;
            }
            
            customers.push(customer);
            autoSaveData();
            updateCustomersGrid();
            updateDashboardStats();
            
            // Close modal and reset form
            bootstrap.Modal.getInstance(document.getElementById('addCustomerModal')).hide();
            e.target.reset();
            
            showToast('Customer added successfully', 'success');
        });
        
        function updateCustomersGrid() {
            const container = document.getElementById('customersGrid');
            
            if (customers.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No customers yet. Add your first customer!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            customers.forEach(customer => {
                // Calculate customer statistics
                const customerBills = allBills.filter(bill => 
                    bill.customerName === customer.name || bill.customerPhone === customer.phone
                );
                const totalSpent = customerBills.reduce((sum, bill) => sum + bill.total, 0);
                const lastPurchase = customerBills.length > 0 ? 
                    new Date(customerBills[customerBills.length - 1].date).toLocaleDateString('en-IN') : 'Never';
                
                html += `
                <div class="col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <div class="avatar-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; font-size: 20px; font-weight: bold;">
                                    ${customer.name.charAt(0).toUpperCase()}
                                </div>
                                <div class="ms-3">
                                    <h5 class="mb-0">${customer.name}</h5>
                                    <small class="text-muted">${customer.phone}</small>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                ${customer.email ? `<p class="mb-1"><i class="fas fa-envelope text-muted me-2"></i> ${customer.email}</p>` : ''}
                                ${customer.address ? `<p class="mb-1"><i class="fas fa-map-marker-alt text-muted me-2"></i> ${customer.address.substring(0, 30)}${customer.address.length > 30 ? '...' : ''}</p>` : ''}
                                <p class="mb-1"><i class="fas fa-rupee-sign text-muted me-2"></i> Total Spent: ₹${totalSpent.toFixed(2)}</p>
                                <p class="mb-0"><i class="fas fa-calendar text-muted me-2"></i> Last Purchase: ${lastPurchase}</p>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewCustomer(${customer.id})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="editCustomer(${customer.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer(${customer.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function viewCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // Get customer's bills
            const customerBills = allBills.filter(bill => 
                bill.customerName === customer.name || bill.customerPhone === customer.phone
            );
            
            let billsHtml = '';
            customerBills.forEach(bill => {
                billsHtml += `
                <tr>
                    <td>${bill.billNumber}</td>
                    <td>${new Date(bill.date).toLocaleDateString('en-IN')}</td>
                    <td>${bill.items.length}</td>
                    <td>₹${bill.total.toFixed(2)}</td>
                    <td><span class="badge bg-success">${bill.status}</span></td>
                </tr>
                `;
            });
            
            const content = `
            <div class="customer-details">
                <div class="text-center mb-4">
                    <div class="avatar-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                         style="width: 80px; height: 80px; font-size: 32px; font-weight: bold;">
                        ${customer.name.charAt(0).toUpperCase()}
                    </div>
                    <h4 class="mt-3">${customer.name}</h4>
                    <p class="text-muted">Customer since ${new Date(customer.createdAt).toLocaleDateString('en-IN')}</p>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5>Contact Information</h5>
                        <p><i class="fas fa-phone me-2"></i> ${customer.phone}</p>
                        ${customer.email ? `<p><i class="fas fa-envelope me-2"></i> ${customer.email}</p>` : ''}
                        ${customer.address ? `<p><i class="fas fa-map-marker-alt me-2"></i> ${customer.address}</p>` : ''}
                    </div>
                    <div class="col-md-6">
                        <h5>Financial Summary</h5>
                        <p><i class="fas fa-rupee-sign me-2"></i> Credit Limit: ₹${customer.creditLimit.toFixed(2)}</p>
                        <p><i class="fas fa-balance-scale me-2"></i> Opening Balance: ₹${customer.openingBalance.toFixed(2)}</p>
                        <p><i class="fas fa-shopping-cart me-2"></i> Total Bills: ${customerBills.length}</p>
                        <p><i class="fas fa-money-bill-wave me-2"></i> Total Spent: ₹${customerBills.reduce((sum, bill) => sum + bill.total, 0).toFixed(2)}</p>
                    </div>
                </div>
                
                ${customerBills.length > 0 ? `
                <h5 class="mb-3">Purchase History</h5>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Bill No.</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${billsHtml}
                        </tbody>
                    </table>
                </div>
                ` : '<p class="text-muted text-center">No purchase history</p>'}
            </div>
            `;
            
            // Show in modal
            document.getElementById('billDetailsContent').innerHTML = content;
            const modal = new bootstrap.Modal(document.getElementById('viewBillModal'));
            modal.show();
        }
        
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            // Populate modal with customer data
            document.getElementById('modalCustomerName').value = customer.name;
            document.getElementById('modalCustomerPhone').value = customer.phone;
            document.getElementById('modalCustomerEmail').value = customer.email || '';
            document.getElementById('modalCustomerAddress').value = customer.address || '';
            document.getElementById('modalCustomerCredit').value = customer.creditLimit;
            document.getElementById('modalCustomerBalance').value = customer.openingBalance;
            
            // Change modal title and submit button
            const modal = document.getElementById('addCustomerModal');
            modal.querySelector('.modal-title').textContent = 'Edit Customer';
            modal.querySelector('button[type="submit"]').textContent = 'Update Customer';
            
            // Remove existing event listener and add new one
            const form = document.getElementById('addCustomerForm');
            const newForm = form.cloneNode(true);
            form.parentNode.replaceChild(newForm, form);
            
            newForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Update customer
                customer.name = document.getElementById('modalCustomerName').value.trim();
                customer.phone = document.getElementById('modalCustomerPhone').value.trim();
                customer.email = document.getElementById('modalCustomerEmail').value.trim();
                customer.address = document.getElementById('modalCustomerAddress').value.trim();
                customer.creditLimit = parseFloat(document.getElementById('modalCustomerCredit').value) || 0;
                customer.openingBalance = parseFloat(document.getElementById('modalCustomerBalance').value) || 0;
                
                autoSaveData();
                updateCustomersGrid();
                
                bootstrap.Modal.getInstance(document.getElementById('addCustomerModal')).hide();
                newForm.reset();
                
                // Reset modal for next use
                modal.querySelector('.modal-title').textContent = 'Add Customer';
                modal.querySelector('button[type="submit"]').textContent = 'Add Customer';
                
                showToast('Customer updated successfully', 'success');
            });
            
            const modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        }
        
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                const index = customers.findIndex(c => c.id === customerId);
                if (index !== -1) {
                    customers.splice(index, 1);
                    autoSaveData();
                    updateCustomersGrid();
                    updateDashboardStats();
                    showToast('Customer deleted successfully', 'success');
                }
            }
        }
        
        function exportCustomers() {
            if (customers.length === 0) {
                showToast('No customers to export', 'warning');
                return;
            }
            
            const csv = convertToCSV(customers);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `customers-export-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Customers exported successfully', 'success');
        }
        
        // ====================
        // REPORTS FUNCTIONS
        // ====================
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const fromDate = document.getElementById('reportFromDate').value;
            const toDate = document.getElementById('reportToDate').value;
            const format = document.getElementById('reportFormat').value;
            
            // Filter bills by date
            let filteredBills = [...allBills];
            
            if (fromDate) {
                const from = new Date(fromDate).getTime();
                filteredBills = filteredBills.filter(bill => new Date(bill.date).getTime() >= from);
            }
            
            if (toDate) {
                const to = new Date(toDate + 'T23:59:59').getTime();
                filteredBills = filteredBills.filter(bill => new Date(bill.date).getTime() <= to);
            }
            
            let reportHtml = '';
            
            switch(reportType) {
                case 'daily':
                    reportHtml = generateDailyReport(filteredBills);
                    break;
                case 'weekly':
                    reportHtml = generateWeeklyReport(filteredBills);
                    break;
                case 'monthly':
                    reportHtml = generateMonthlyReport(filteredBills);
                    break;
                case 'yearly':
                    reportHtml = generateYearlyReport(filteredBills);
                    break;
                case 'customer':
                    reportHtml = generateCustomerReport(filteredBills);
                    break;
                case 'product':
                    reportHtml = generateProductReport(filteredBills);
                    break;
            }
            
            // Add report header
            const header = `
            <div class="report-header mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h4>${settings.shopName || 'BusinessOS'}</h4>
                        <p class="text-muted mb-0">${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</p>
                        <p class="text-muted">
                            ${fromDate ? `From: ${new Date(fromDate).toLocaleDateString('en-IN')}` : 'All Time'} 
                            ${toDate ? `To: ${new Date(toDate).toLocaleDateString('en-IN')}` : ''}
                        </p>
                    </div>
                    <div class="text-end">
                        <p class="mb-0">Generated: ${new Date().toLocaleDateString('en-IN')}</p>
                        <p class="mb-0">Total Records: ${filteredBills.length}</p>
                    </div>
                </div>
                <hr>
            </div>
            `;
            
            document.getElementById('reportOutput').innerHTML = header + reportHtml;
            
            if (format === 'pdf') {
                showToast('PDF export feature coming soon!', 'info');
            } else if (format === 'excel') {
                exportReportToExcel(reportType, filteredBills);
            }
        }
        
        function generateDailyReport(bills) {
            // Group by date
            const dailyData = {};
            bills.forEach(bill => {
                const date = new Date(bill.date).toLocaleDateString('en-IN');
                if (!dailyData[date]) {
                    dailyData[date] = { total: 0, count: 0, bills: [] };
                }
                dailyData[date].total += bill.total;
                dailyData[date].count++;
                dailyData[date].bills.push(bill);
            });
            
            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Date</th><th>Bills</th><th>Total Sales</th><th>Average Bill</th><th>Details</th></tr></thead><tbody>';
            
            let grandTotal = 0;
            let grandCount = 0;
            
            Object.entries(dailyData).forEach(([date, data]) => {
                html += `<tr>
                    <td>${date}</td>
                    <td>${data.count}</td>
                    <td>₹${data.total.toFixed(2)}</td>
                    <td>₹${(data.total / data.count).toFixed(2)}</td>
                    <td><button class="btn btn-sm btn-outline-primary" onclick="viewDailyDetails('${date}')">View</button></td>
                </tr>`;
                grandTotal += data.total;
                grandCount += data.count;
            });
            
            html += `</tbody></table></div>
            <div class="alert alert-primary mt-3">
                <h5>Summary</h5>
                <p class="mb-1"><strong>Total Period:</strong> ${Object.keys(dailyData).length} days</p>
                <p class="mb-1"><strong>Total Bills:</strong> ${grandCount}</p>
                <p class="mb-1"><strong>Total Sales:</strong> ₹${grandTotal.toFixed(2)}</p>
                <p class="mb-0"><strong>Average Daily Sales:</strong> ₹${(grandTotal / Object.keys(dailyData).length || 0).toFixed(2)}</p>
            </div>`;
            
            return html;
        }
        
        function generateWeeklyReport(bills) {
            // Simplified weekly report
            const weeklyTotal = bills.reduce((sum, bill) => sum + bill.total, 0);
            const weeklyCount = bills.length;
            
            return `
            <div class="alert alert-info">
                <h5>Weekly Summary</h5>
                <p class="mb-1"><strong>Total Bills:</strong> ${weeklyCount}</p>
                <p class="mb-1"><strong>Total Sales:</strong> ₹${weeklyTotal.toFixed(2)}</p>
                <p class="mb-1"><strong>Average Bill Value:</strong> ₹${(weeklyTotal / weeklyCount || 0).toFixed(2)}</p>
                <p class="mb-0"><strong>Period Covered:</strong> ${bills.length > 0 ? 
                    `${new Date(Math.min(...bills.map(b => new Date(b.date).getTime()))).toLocaleDateString('en-IN')} to ${new Date(Math.max(...bills.map(b => new Date(b.date).getTime()))).toLocaleDateString('en-IN')}` : 
                    'No data'}</p>
            </div>
            `;
        }
        
        function generateMonthlyReport(bills) {
            // Group by month
            const monthlyData = {};
            bills.forEach(bill => {
                const date = new Date(bill.date);
                const monthYear = `${date.toLocaleString('en-IN', { month: 'long' })} ${date.getFullYear()}`;
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = { total: 0, count: 0 };
                }
                monthlyData[monthYear].total += bill.total;
                monthlyData[monthYear].count++;
            });
            
            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Month</th><th>Bills</th><th>Total Sales</th><th>Average Bill</th></tr></thead><tbody>';
            
            Object.entries(monthlyData).forEach(([month, data]) => {
                html += `<tr>
                    <td>${month}</td>
                    <td>${data.count}</td>
                    <td>₹${data.total.toFixed(2)}</td>
                    <td>₹${(data.total / data.count).toFixed(2)}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            return html;
        }
        
        function generateYearlyReport(bills) {
            // Similar to monthly but yearly
            return generateMonthlyReport(bills);
        }
        
        function generateCustomerReport(bills) {
            // Group by customer
            const customerData = {};
            bills.forEach(bill => {
                if (!customerData[bill.customerName]) {
                    customerData[bill.customerName] = { total: 0, count: 0 };
                }
                customerData[bill.customerName].total += bill.total;
                customerData[bill.customerName].count++;
            });
            
            // Convert to array and sort by total
            const sortedCustomers = Object.entries(customerData)
                .map(([name, data]) => ({ name, ...data }))
                .sort((a, b) => b.total - a.total);
            
            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Customer</th><th>Bills</th><th>Total Spent</th><th>Average Bill</th><th>% of Total</th></tr></thead><tbody>';
            
            const grandTotal = sortedCustomers.reduce((sum, cust) => sum + cust.total, 0);
            
            sortedCustomers.forEach(cust => {
                const percentage = grandTotal > 0 ? ((cust.total / grandTotal) * 100).toFixed(1) : '0.0';
                html += `<tr>
                    <td>${cust.name}</td>
                    <td>${cust.count}</td>
                    <td>₹${cust.total.toFixed(2)}</td>
                    <td>₹${(cust.total / cust.count).toFixed(2)}</td>
                    <td>${percentage}%</td>
                </tr>`;
            });
            
            html += `</tbody></table></div>
            <div class="alert alert-success mt-3">
                <p class="mb-1"><strong>Total Customers:</strong> ${sortedCustomers.length}</p>
                <p class="mb-1"><strong>Total Sales:</strong> ₹${grandTotal.toFixed(2)}</p>
                <p class="mb-0"><strong>Top Customer:</strong> ${sortedCustomers.length > 0 ? sortedCustomers[0].name : 'None'}</p>
            </div>`;
            
            return html;
        }
        
        function generateProductReport(bills) {
            // Aggregate all items from all bills
            const productData = {};
            bills.forEach(bill => {
                bill.items.forEach(item => {
                    if (!productData[item.name]) {
                        productData[item.name] = { quantity: 0, revenue: 0 };
                    }
                    productData[item.name].quantity += item.quantity;
                    productData[item.name].revenue += item.amount;
                });
            });
            
            // Convert to array and sort by revenue
            const sortedProducts = Object.entries(productData)
                .map(([name, data]) => ({ name, ...data }))
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 20); // Top 20 products
            
            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Product</th><th>Quantity Sold</th><th>Revenue</th><th>Average Price</th></tr></thead><tbody>';
            
            sortedProducts.forEach(product => {
                html += `<tr>
                    <td>${product.name}</td>
                    <td>${product.quantity}</td>
                    <td>₹${product.revenue.toFixed(2)}</td>
                    <td>₹${(product.revenue / product.quantity).toFixed(2)}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            return html;
        }
        
        function exportReportToExcel(reportType, data) {
            showToast('Excel export feature coming soon!', 'info');
        }
        
        // ====================
        // SETTINGS FUNCTIONS
        // ====================
        function updateSettingsForm() {
            document.getElementById('settingShopName').value = settings.shopName || '';
            document.getElementById('settingGST').value = settings.gstNumber || '';
            document.getElementById('settingAddress').value = settings.address || '';
            document.getElementById('settingPhone').value = settings.phone || '';
            document.getElementById('settingEmail').value = settings.email || '';
            document.getElementById('settingDefaultGST').value = settings.defaultGST || '18';
            document.getElementById('settingInvoicePrefix').value = settings.invoicePrefix || 'INV-';
            document.getElementById('settingInvoiceFooter').value = settings.invoiceFooter || 'Thank you for your business!';
            document.getElementById('settingTerms').value = settings.terms || 'Goods once sold will not be taken back.';
        }
        
        function saveSettings() {
            settings.shopName = document.getElementById('settingShopName').value.trim();
            settings.gstNumber = document.getElementById('settingGST').value.trim();
            settings.address = document.getElementById('settingAddress').value.trim();
            settings.phone = document.getElementById('settingPhone').value.trim();
            settings.email = document.getElementById('settingEmail').value.trim();
            settings.defaultGST = document.getElementById('settingDefaultGST').value;
            settings.invoicePrefix = document.getElementById('settingInvoicePrefix').value.trim();
            settings.invoiceFooter = document.getElementById('settingInvoiceFooter').value.trim();
            settings.terms = document.getElementById('settingTerms').value.trim();
            
            autoSaveData();
            showToast('Settings saved successfully', 'success');
        }
        
        function clearDrafts() {
            if (confirm('Clear all draft bills?')) {
                // In a real app, you would filter out draft bills
                showToast('Drafts cleared', 'info');
            }
        }
        
        // ====================
        // UTILITY FUNCTIONS
        // ====================
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to clicked link
            event.target.classList.add('active');
            
            // Update content if needed
            if (sectionName === 'dashboard') {
                updateDashboardStats();
                updateChart();
            } else if (sectionName === 'billing') {
                updateAllBillsTable();
            } else if (sectionName === 'inventory') {
                updateInventoryTable();
            } else if (sectionName === 'customers') {
                updateCustomersGrid();
            } else if (sectionName === 'settings') {
                updateSettingsForm();
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                document.getElementById('sidebar').classList.remove('show');
            }
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('toastMessage');
            
            // Update toast style based on type
            const header = toast.querySelector('.toast-header');
            header.className = `toast-header bg-${type} text-white`;
            
            // Update message
            toastMessage.textContent = message;
            
            // Show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        function playSuccessSound() {
            // Simple success sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // Audio not supported, continue silently
            }
        }
        
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [];
            
            // Add headers
            csvRows.push(headers.join(','));
            
            // Add data rows
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header];
                    // Handle values that might contain commas
                    return typeof value === 'string' && value.includes(',') ? 
                        `"${value}"` : value;
                });
                csvRows.push(values.join(','));
            });
            
            return csvRows.join('\n');
        }
        
        function setupInactivityTimer() {
            let timeout;
            
            function resetTimer() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    // Auto-save before logout
                    autoSaveData();
                    // Optional: Show logout message
                    // showToast('Session expired due to inactivity', 'warning');
                }, 30 * 60 * 1000); // 30 minutes
            }
            
            // Reset timer on user activity
            ['click', 'mousemove', 'keypress', 'scroll'].forEach(event => {
                document.addEventListener(event, resetTimer);
            });
            
            resetTimer();
        }
        
        // ====================
        // HELPER FUNCTIONS FOR VIEWING DAILY DETAILS
        // ====================
        function viewDailyDetails(date) {
            const dailyBills = allBills.filter(bill => 
                new Date(bill.date).toLocaleDateString('en-IN') === date
            );
            
            let billsHtml = '';
            dailyBills.forEach(bill => {
                billsHtml += `
                <tr>
                    <td>${bill.billNumber}</td>
                    <td>${bill.customerName}</td>
                    <td>${bill.items.length}</td>
                    <td>₹${bill.total.toFixed(2)}</td>
                    <td>${bill.paymentMode}</td>
                </tr>
                `;
            });
            
            const content = `
            <div class="daily-details">
                <h5>Bills for ${date}</h5>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Bill No.</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Amount</th>
                                <th>Payment Mode</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${billsHtml}
                        </tbody>
                    </table>
                </div>
            </div>
            `;
            
            // Show in modal
            document.getElementById('billDetailsContent').innerHTML = content;
            const modal = new bootstrap.Modal(document.getElementById('viewBillModal'));
            modal.show();
        }
    </script>
</body>
</html>